# WAF-Guard Configuration Defaults
# Based on OWASP ModSecurity CRS official Docker image

apache:
  # Server Configuration
  SERVER_NAME: "localhost"
  SERVER_ADMIN: "root@localhost"
  SERVER_SIGNATURE: "Off"
  SERVER_TOKENS: "Full"
  PORT: "8080"
  SSL_PORT: "8443"
  
  # Timeouts
  TIMEOUT: "60"
  PROXY_TIMEOUT: "60"
  WORKER_CONNECTIONS: "400"
  MUTEX: "default"
  
  # Logging
  ACCESSLOG: "/var/log/apache2/access.log"
  ERRORLOG: "/proc/self/fd/2"  # stderr for Docker
  METRICSLOG: "/dev/null"
  LOGLEVEL: "warn"
  
  APACHE_LOGFORMAT: '"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\""'
  APACHE_METRICS_LOGFORMAT: '"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\""'
  APACHE_ERRORLOG_FORMAT: '"[%{u}t] [%-m:%l] [pid %P:tid %T] %7F: %E: [client\ %a] %M% ,\ referer\ %{Referer}i"'
  
  # HTTP/2 Configuration
  H2_DIRECT: "on"
  H2_PROTOCOLS: "h2 h2c http/1.1"
  
  # SSL/TLS Configuration
  SSL_ENGINE: "on"
  SSL_CERT_FILE: "/usr/local/apache2/conf/server.crt"
  SSL_CERT_KEY_FILE: "/usr/local/apache2/conf/server.key"
  SSL_PROTOCOLS: "all -SSLv3 -TLSv1 -TLSv1.1"
  SSL_CIPHERS: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
  SSL_HONOR_CIPHER_ORDER: "off"
  SSL_SESSION_TICKETS: "off"
  SSL_OCSP_STAPLING: "On"
  
  # Proxy Configuration
  BACKEND: "http://localhost:80"
  BACKEND_WS: "ws://localhost:8081"
  PROXY_SSL: "off"
  PROXY_SSL_CERT_FILE: "/usr/local/apache2/conf/proxy.crt"
  PROXY_SSL_CERT_KEY_FILE: "/usr/local/apache2/conf/proxy.key"
  PROXY_SSL_CA_CERT_FILE: "/etc/ssl/certs/ca-certificates.crt"
  PROXY_SSL_PROTOCOLS: "all -SSLv3 -TLSv1 -TLSv1.1"
  PROXY_SSL_CIPHERS: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
  PROXY_SSL_VERIFY: "none"
  PROXY_SSL_CHECK_PEER_NAME: "off"
  PROXY_PRESERVE_HOST: "on"
  PROXY_ERROR_OVERRIDE: "on"
  
  # RemoteIP Configuration
  REMOTEIP_HEADER: "X-Forwarded-For"
  REMOTEIP_INT_PROXY: "10.1.0.0/16"
  REQ_HEADER_FORWARDED_PROTO: "https"
  
  # TLS Redirect
  APACHE_ALWAYS_TLS_REDIRECT: "off"
  
  # Metrics
  METRICS_ALLOW_FROM: "127.0.0.0/255.0.0.0 ::1/128"
  METRICS_DENY_FROM: "All"

modsecurity:
  # Rule Engine
  MODSEC_RULE_ENGINE: "on"
  MODSEC_TAG: "modsecurity"
  
  # Request Body Configuration
  MODSEC_REQ_BODY_ACCESS: "on"
  MODSEC_REQ_BODY_LIMIT: "13107200"  # 12.5 MB
  MODSEC_REQ_BODY_NOFILES_LIMIT: "131072"  # 128 KB
  MODSEC_REQ_BODY_LIMIT_ACTION: "Reject"
  MODSEC_REQ_BODY_JSON_DEPTH_LIMIT: "512"
  
  # Response Body Configuration
  MODSEC_RESP_BODY_ACCESS: "on"
  MODSEC_RESP_BODY_LIMIT: "1048576"  # 1 MB
  MODSEC_RESP_BODY_LIMIT_ACTION: "ProcessPartial"
  MODSEC_RESP_BODY_MIMETYPE: "text/plain text/html text/xml"
  
  # Filesystem Paths
  MODSEC_TMP_DIR: "/tmp/modsecurity/tmp"
  MODSEC_DATA_DIR: "/tmp/modsecurity/data"
  MODSEC_UPLOAD_DIR: "/tmp/modsecurity/upload"
  
  # File Upload Configuration
  MODSEC_TMP_SAVE_UPLOADED_FILES: "on"
  MODSEC_UPLOAD_FILE_MODE: "0600"
  MODSEC_UPLOAD_KEEP_FILES: "RelevantOnly"
  
  # Audit Logging
  MODSEC_AUDIT_ENGINE: "RelevantOnly"
  MODSEC_AUDIT_LOG: "/dev/stdout"  # stdout for Docker
  MODSEC_AUDIT_LOG_FORMAT: "JSON"
  MODSEC_AUDIT_LOG_PARTS: "ABIJDEFHZ"
  MODSEC_AUDIT_LOG_RELEVANT_STATUS: "^(?:5|4(?!04))"
  MODSEC_AUDIT_LOG_TYPE: "Serial"
  MODSEC_AUDIT_STORAGE_DIR: "/var/log/modsecurity/audit/"
  
  # Debug Logging
  MODSEC_DEBUG_LOG: "/dev/null"
  MODSEC_DEBUG_LOGLEVEL: "0"
  
  # Arguments and Parsing
  MODSEC_ARGUMENT_SEPARATOR: "&"
  MODSEC_ARGUMENTS_LIMIT: "1000"
  MODSEC_COOKIE_FORMAT: "0"
  
  # PCRE Limits
  MODSEC_PCRE_MATCH_LIMIT: "100000"
  MODSEC_PCRE_MATCH_LIMIT_RECURSION: "100000"
  
  # Unicode Mapping
  MODSEC_UNICODE_MAPPING: "20127"
  
  # Server Signature
  MODSEC_SERVER_SIGNATURE: "Apache"
  
  # Status Engine
  MODSEC_STATUS_ENGINE: "Off"
  
  # Backend Compression
  MODSEC_DISABLE_BACKEND_COMPRESSION: "On"
  
  # Default Actions
  MODSEC_DEFAULT_PHASE1_ACTION: "phase:1,pass,log,tag:'${MODSEC_TAG}'"
  MODSEC_DEFAULT_PHASE2_ACTION: "phase:2,pass,log,tag:'${MODSEC_TAG}'"

# CRS Specific Configuration (optional)
crs:
  ANOMALY_INBOUND: "5"
  ANOMALY_OUTBOUND: "4"
  BLOCKING_PARANOIA: "1"

# Preset Configurations
# presets:
#   development:
#     apache:
#       LOGLEVEL: "debug"
#       ERRORLOG: "/var/log/apache2/error.log"
#       ACCESSLOG: "/var/log/apache2/access.log"
#       METRICSLOG: "/var/log/apache2/metrics.log"
#     modsecurity:
#       MODSEC_RULE_ENGINE: "DetectionOnly"
#       MODSEC_DEBUG_LOG: "/var/log/apache2/modsec_debug.log"
#       MODSEC_DEBUG_LOGLEVEL: "9"
#       MODSEC_AUDIT_ENGINE: "On"
#       MODSEC_AUDIT_LOG: "/var/log/apache2/modsec_audit.log"
#     crs:
#       BLOCKING_PARANOIA: "1"
  
#   production:
#     apache:
#       LOGLEVEL: "warn"
#       SERVER_TOKENS: "Prod"
#       ERRORLOG: "/var/log/apache2/error.log"
#       ACCESSLOG: "/var/log/apache2/access.log"
#     modsecurity:
#       MODSEC_RULE_ENGINE: "On"
#       MODSEC_DEBUG_LOG: "/dev/null"
#       MODSEC_DEBUG_LOGLEVEL: "0"
#       MODSEC_AUDIT_ENGINE: "RelevantOnly"
#       MODSEC_AUDIT_LOG: "/var/log/apache2/modsec_audit.log"
#     crs:
#       BLOCKING_PARANOIA: "2"
#       ANOMALY_INBOUND: "5"
  
#   testing:
#     apache:
#       LOGLEVEL: "info"
#       ERRORLOG: "/var/log/apache2/error.log"
#       ACCESSLOG: "/var/log/apache2/access.log"
#       METRICSLOG: "/var/log/apache2/metrics.log"
#     modsecurity:
#       MODSEC_RULE_ENGINE: "DetectionOnly"
#       MODSEC_DEBUG_LOG: "/var/log/apache2/modsec_debug.log"
#       MODSEC_DEBUG_LOGLEVEL: "3"
#       MODSEC_AUDIT_ENGINE: "On"
#       MODSEC_AUDIT_LOG: "/var/log/apache2/modsec_audit.log"
#     crs:
#       BLOCKING_PARANOIA: "1"
  
#   paranoid:
#     apache:
#       LOGLEVEL: "warn"
#       SERVER_TOKENS: "Prod"
#     modsecurity:
#       MODSEC_RULE_ENGINE: "On"
#       MODSEC_DEBUG_LOGLEVEL: "0"
#       MODSEC_AUDIT_ENGINE: "RelevantOnly"
#     crs:
#       BLOCKING_PARANOIA: "4"
#       ANOMALY_INBOUND: "3"
#       ANOMALY_OUTBOUND: "3"