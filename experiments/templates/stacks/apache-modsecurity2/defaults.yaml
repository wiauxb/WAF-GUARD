# Apache Configuration
ACCESSLOG: /var/log/apache2/access.log
ERRORLOG: /var/log/apache2/error.log
LOGLEVEL: warn
APACHE_ALWAYS_TLS_REDIRECT: "off"
APACHE_ERRORLOG_FORMAT: '"[%{u}t] [%-m:%l] [pid %P:tid %T] %7F: %E: [client\ %a] %M% ,\ referer\ %{Referer}i"'
APACHE_LOGFORMAT: '"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\""'
APACHE_METRICS_LOGFORMAT: '"%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\""'
MUTEX: default
PORT: 8080
TIMEOUT: 60
WORKER_CONNECTIONS: 400

# Server
SERVER_ADMIN: root@localhost
SERVER_NAME: localhost
SERVERNAME: modsec2-apache
SERVER_SIGNATURE: "Off"
SERVER_TOKENS: Full

# Backend/Proxy
BACKEND: http://localhost:80
BACKEND_WS: ws://localhost:8081
PROXY_ERROR_OVERRIDE: "on"
PROXY_PRESERVE_HOST: "on"
PROXY_TIMEOUT: 60

# HTTP/2
H2_DIRECT: "on"
H2_PROTOCOLS: h2 h2c http/1.1

# Metrics
METRICS_ALLOW_FROM: 127.0.0.0/255.0.0.0 ::1/128
METRICS_DENY_FROM: All
METRICSLOG: /dev/null

# Remote IP
REMOTEIP_INT_PROXY: 10.1.0.0/16
REMOTEIP_HEADER: X-Forwarded-For
REQ_HEADER_FORWARDED_PROTO: https

# SSL/TLS
SSL_ENGINE: "on"
SSL_PORT: 8443
SSL_CERT_FILE: /usr/local/apache2/conf/server.crt
SSL_CERT_KEY_FILE: /usr/local/apache2/conf/server.key
SSL_CIPHERS: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
SSL_HONOR_CIPHER_ORDER: "off"
SSL_OCSP_STAPLING: "On"
SSL_PROTOCOLS: all -SSLv3 -TLSv1 -TLSv1.1
SSL_SESSION_TICKETS: "off"

# Proxy SSL
PROXY_SSL: "off"
PROXY_SSL_CA_CERT_FILE: /etc/ssl/certs/ca-certificates.crt
PROXY_SSL_CERT_FILE: /usr/local/apache2/conf/proxy.crt
PROXY_SSL_CERT_KEY_FILE: /usr/local/apache2/conf/proxy.key
PROXY_SSL_CHECK_PEER_NAME: "off"
PROXY_SSL_CIPHERS: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
PROXY_SSL_PROTOCOLS: all -SSLv3 -TLSv1 -TLSv1.1
PROXY_SSL_VERIFY: none

# ModSecurity General
MODSEC_RULE_ENGINE: DetectionOnly
MODSEC_TAG: modsecurity
MODSEC_SERVER_SIGNATURE: Apache
MODSEC_STATUS_ENGINE: "Off"

# ModSecurity Request Body
MODSEC_REQ_BODY_ACCESS: "on"
MODSEC_REQ_BODY_LIMIT: 13107200
MODSEC_REQ_BODY_NOFILES_LIMIT: 131072
MODSEC_REQ_BODY_LIMIT_ACTION: Reject
MODSEC_REQ_BODY_JSON_DEPTH_LIMIT: 512

# ModSecurity Response Body
MODSEC_RESP_BODY_ACCESS: "on"
MODSEC_RESP_BODY_LIMIT: 1048576
MODSEC_RESP_BODY_LIMIT_ACTION: ProcessPartial
MODSEC_RESP_BODY_MIMETYPE: text/plain text/html text/xml

# ModSecurity Arguments
MODSEC_ARGUMENT_SEPARATOR: "&"
MODSEC_ARGUMENTS_LIMIT: 1000
MODSEC_COOKIE_FORMAT: 0

# ModSecurity PCRE
MODSEC_PCRE_MATCH_LIMIT: 100000
MODSEC_PCRE_MATCH_LIMIT_RECURSION: 100000

# ModSecurity Directories
MODSEC_DATA_DIR: /tmp/modsecurity/data
MODSEC_TMP_DIR: /tmp/modsecurity/tmp
MODSEC_UPLOAD_DIR: /tmp/modsecurity/upload

# ModSecurity Upload
MODSEC_TMP_SAVE_UPLOADED_FILES: "on"
MODSEC_UPLOAD_FILE_MODE: "0600"
MODSEC_UPLOAD_KEEP_FILES: RelevantOnly

# ModSecurity Audit
MODSEC_AUDIT_ENGINE: RelevantOnly
MODSEC_AUDIT_LOG: /var/log/apache2/modsec_audit.log
MODSEC_AUDIT_LOG_FORMAT: JSON
MODSEC_AUDIT_LOG_PARTS: ABIJDEFHKZ
MODSEC_AUDIT_LOG_RELEVANT_STATUS: "^(?:5|4(?!04))"
MODSEC_AUDIT_LOG_TYPE: Serial
MODSEC_AUDIT_STORAGE_DIR: /var/log/apache2/audit/

# ModSecurity Debug
MODSEC_DEBUG_LOG: /dev/null
MODSEC_DEBUG_LOGLEVEL: 0

# ModSecurity Other
MODSEC_DISABLE_BACKEND_COMPRESSION: "On"
MODSEC_UNICODE_MAPPING: 20127
MODSEC_DEFAULT_PHASE1_ACTION: "phase:1,pass,log,tag:'${MODSEC_TAG}'"
MODSEC_DEFAULT_PHASE2_ACTION: "phase:2,pass,log,tag:'${MODSEC_TAG}'"

# CRS (Core Rule Set)
ANOMALY_INBOUND: 5
ANOMALY_OUTBOUND: 4
BLOCKING_PARANOIA: 2
COMBINED_FILE_SIZES: 65535
